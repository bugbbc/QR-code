<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no"
    />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Admin Panel</title>
    <link rel="stylesheet" href="./style.css?v=20250114-1" />
    <style>
      .login {
        max-width: 420px;
        margin: 40px auto;
      }
      .form-row {
        display: flex;
        gap: 12px;
        margin-bottom: 12px;
      }
      .form-row label {
        width: 90px;
        color: #555;
      }
      .form-row input,
      .form-row textarea {
        flex: 1;
        padding: 8px 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }
      @media (min-width: 768px) {
        .grid {
          grid-template-columns: 1fr 1fr;
        }
      }
      .card h3 {
        margin-top: 0;
      }
      .qr-box {
        display: flex;
        gap: 16px;
        align-items: center;
      }
      #qrcode {
        width: 280px;
        height: 280px;
        background: #fff;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .stats-table {
        width: 100%;
        border-collapse: collapse;
      }
      .stats-table th,
      .stats-table td {
        border: 1px solid #eee;
        padding: 6px 8px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <header class="header"><h1>Admin Management System</h1></header>
    <main class="content">
      <section id="login-section" class="card login">
        <h3>Admin Login</h3>
        <div class="form-row">
          <label>Username</label><input id="username" placeholder="admin" />
        </div>
        <div class="form-row">
          <label>Password</label
          ><input id="password" type="password" placeholder="password123" />
        </div>
        <button id="login-btn" class="btn primary">Login</button>
      </section>

      <section id="admin-section" class="hidden">
        <div class="grid">
          <div class="card">
            <h3>Product Content Management</h3>
            <div class="form-row">
              <label>Product ID</label
              ><input id="productId" placeholder="default-product" />
            </div>
            <div class="form-row"><label>Name</label><input id="name" /></div>
            <div class="form-row">
              <label>Specifications</label
              ><textarea id="specs" rows="4"></textarea>
            </div>
            <div class="form-row">
              <label>Features</label
              ><textarea id="features" rows="6"></textarea>
            </div>
            <div class="form-row">
              <label>Usage Instructions</label
              ><textarea id="usage" rows="4"></textarea>
            </div>
            <div class="form-row">
              <label>Contact Information</label
              ><textarea id="contact" rows="3"></textarea>
            </div>
            <div class="form-row">
              <label>Purchase Link 1</label><input id="link1" />
            </div>
            <div class="form-row">
              <label>Purchase Link 2</label><input id="link2" />
            </div>
            <div class="form-row">
              <label>Coupon Text</label><input id="couponText" />
            </div>
            <div class="form-row">
              <label>Coupon URL</label><input id="couponUrl" />
            </div>
            <div class="form-row">
              <label>Scan Limit</label
              ><input id="scanLimit" type="number" min="1" value="3" />
            </div>
            <div style="display: flex; gap: 8px; flex-wrap: wrap">
              <button id="save-btn" class="btn primary">Save and Apply</button>
              <button id="export-json" class="btn">Export Config JSON</button>
            </div>
          </div>

          <div class="card">
            <h3>Statistics</h3>
            <p>
              Total Scans: <span id="totalScans">0</span>, Devices:
              <span id="deviceCount">0</span>
            </p>
            <table class="stats-table">
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Count</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>First Scan</td>
                  <td id="firstCount">0</td>
                </tr>
                <tr>
                  <td>2nd-3rd Scan</td>
                  <td id="secondCount">0</td>
                </tr>
                <tr>
                  <td>Invalid (â‰¥4)</td>
                  <td id="invalidCount">0</td>
                </tr>
              </tbody>
            </table>
            <h4>Device Type</h4>
            <ul>
              <li>Android: <span id="androidCount">0</span></li>
              <li>iOS: <span id="iosCount">0</span></li>
              <li>Other: <span id="otherCount">0</span></li>
            </ul>
            <h4>Regions (Sampling)</h4>
            <div id="regions" class="text-block"></div>
            <div style="margin-top: 8px; display: flex; gap: 8px">
              <button id="refresh-stats" class="btn">Refresh Statistics</button>
              <button id="reset-stats" class="btn">
                Clear Statistics & Counts
              </button>
            </div>
          </div>
        </div>

        <section class="card" id="code-management">
          <h3>
            One Code Per Product / Anti-Counterfeit QR Code Batch Generation
          </h3>
          <p style="color: #555">
            Each QR code is bound to a unique code and scan limit. When
            scanning, the <code>code</code> parameter must be included (e.g.,
            <code>?id=xxx&amp;code=XXXX</code>). Exceeding the limit will be
            considered invalid.
          </p>
          <div class="form-row">
            <label>API Service Address</label>
            <input
              id="apiBase"
              placeholder="ç•™ç©ºåˆ™ä½¿ç”¨ç›¸å¯¹è·¯å¾„ (/api/...)ï¼Œæˆ–å¡«å†™å®Œæ•´ API åœ°å€ï¼ˆå¦‚ Cloudflare Workers URLï¼‰"
            />
            <small
              style="
                display: block;
                margin-top: 4px;
                color: #666;
                font-size: 12px;
              "
            >
              ğŸ’¡ æç¤ºï¼šå¦‚æœ API éƒ¨ç½²åœ¨åŒä¸€ä¸ªåŸŸåä¸‹ï¼ˆå¦‚
              miraclewhite.topï¼‰ï¼Œå¯ä»¥ç•™ç©ºæ­¤å­—æ®µä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚
              <br />
              å¦‚æœ API éƒ¨ç½²åœ¨ Cloudflare Workersï¼Œè¯·å¡«å†™å®Œæ•´çš„ Worker URLã€‚
              <br />
              âš ï¸ ä¸è¦ä½¿ç”¨ localhost åœ°å€ï¼Œå› ä¸ºä»åŸŸåè®¿é—®æ—¶æ— æ³•è®¿é—® localhostã€‚
            </small>
          </div>
          <div class="form-row">
            <label>Product ID</label>
            <input
              id="codeProductId"
              placeholder="Leave empty to use the product ID above"
            />
          </div>
          <div class="form-row">
            <label>Quantity</label>
            <input
              id="codeQuantity"
              type="number"
              min="1"
              max="500"
              value="10"
            />
          </div>
          <div class="form-row">
            <label>Scan Limit</label>
            <input id="codeScanLimit" type="number" min="1" value="3" />
          </div>
          <div style="display: flex; gap: 8px; flex-wrap: wrap">
            <button id="generate-codes" class="btn primary">
              Batch Generate QR Codes
            </button>
            <button id="refresh-code-list" class="btn">
              Refresh QR Code List
            </button>
          </div>
          <div id="latest-code-batch" class="hidden" style="margin-top: 16px">
            <h4>Latest Generation Results</h4>
            <p>
              Total Generated: <strong id="latest-code-count">0</strong> QR
              Codes.
              <button
                id="download-latest-csv"
                class="btn"
                style="margin-left: 8px"
              >
                Export CSV
              </button>
            </p>
            <div style="overflow-x: auto">
              <table class="stats-table">
                <thead>
                  <tr>
                    <th>No.</th>
                    <th>QR Code</th>
                    <th>Code</th>
                    <th>Token</th>
                    <th>Scan Link</th>
                    <th>Created At</th>
                  </tr>
                </thead>
                <tbody id="latest-code-body"></tbody>
              </table>
            </div>
          </div>
          <div style="margin-top: 16px">
            <h4>All QR Codes for Current Product</h4>
            <p id="code-empty" style="color: #777">
              No records yet. Please generate first.
            </p>
            <div style="overflow-x: auto">
              <table class="stats-table" id="code-table">
                <thead>
                  <tr>
                    <th>Code</th>
                    <th>Status</th>
                    <th>Total Scans</th>
                    <th>Limit</th>
                    <th>Created At</th>
                    <th>Last Scan</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="code-table-body"></tbody>
              </table>
            </div>
          </div>
        </section>

        <div class="card">
          <h3>åŠ¨æ€äºŒç»´ç ç”Ÿæˆä¸ä¸‹è½½</h3>
          <div class="qr-box">
            <div id="qrcode"></div>
            <div>
              <p>æ‰«æè·³è½¬é“¾æ¥ï¼š<code id="qr-url"></code></p>
              <button id="gen-qr" class="btn">ç”ŸæˆäºŒç»´ç </button>
              <button id="download-qr" class="btn primary">ä¸‹è½½é«˜æ¸…PNG</button>
            </div>
          </div>
          <small
            >è¯´æ˜ï¼šäºŒç»´ç æŒ‡å‘ç»Ÿä¸€å•†å“è¯¦æƒ…é¡µï¼Œé€šè¿‡äº§å“IDè¯»å–é…ç½®ï¼Œä¿®æ”¹å†…å®¹æ— éœ€é‡æ–°ç”ŸæˆäºŒç»´ç ã€‚</small
          >
          <div class="card">
            <h2>Dynamic QR Code Settings</h2>
            <div class="form-row">
              <label for="serverHost">æœåŠ¡å™¨ä¸»æœºï¼ˆä¾›æ‰‹æœºè®¿é—®ï¼‰</label>
              <input
                id="serverHost"
                type="text"
                placeholder="ä¾‹å¦‚ï¼š192.168.1.100:8000"
              />
              <small
                >æç¤ºï¼š<br />
                1. æœ¬åœ°æµ‹è¯•ï¼šè¾“å…¥å±€åŸŸç½‘IPåŠ ç«¯å£ï¼Œå¦‚ 192.168.1.100:8000<br />
                2. ä½¿ç”¨åŸŸåï¼šç›´æ¥è¾“å…¥æ‚¨çš„åŸŸåï¼Œå¦‚
                your-domain.comï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«HTTPSï¼‰<br />
                3. è‹¥ä¸ºç©ºåˆ™ä½¿ç”¨å½“å‰æµè§ˆå™¨çš„ä¸»æœº</small
              >
            </div>
          </div>
        </div>

        <div class="card">
          <h3>ç¦»çº¿äºŒç»´ç ç”Ÿæˆï¼ˆå®Œå…¨è‡ªåŒ…å«ï¼‰</h3>
          <div
            style="
              background: #e7f3ff;
              border-left: 4px solid #0b72ff;
              padding: 12px;
              margin-bottom: 16px;
              border-radius: 4px;
            "
          >
            <strong>âœ¨ æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong>
            <p style="margin: 8px 0 0 0; color: #333">
              <strong
                >æ‰«ç åç›´æ¥æ˜¾ç¤ºæ‚¨è®¾è®¡çš„HTMLé¡µé¢ï¼Œæ— éœ€è·³è½¬åˆ°ä»»ä½•URLï¼</strong
              ><br />
              äºŒç»´ç æœ¬èº«åŒ…å«å®Œæ•´çš„HTMLå†…å®¹ï¼ˆCSSã€JSã€å›¾ç‰‡å…¨éƒ¨å†…è”ï¼‰ï¼Œæ‰«ç åæµè§ˆå™¨ç›´æ¥è§£ææ˜¾ç¤ºï¼Œå®Œå…¨ç¦»çº¿å¯ç”¨ã€‚
            </p>
          </div>
          <p style="color: #666; margin-bottom: 16px">
            ä¸ä¸Šæ–¹çš„"åŠ¨æ€äºŒç»´ç "ä¸åŒï¼Œç¦»çº¿äºŒç»´ç ä¸ä¾èµ–æœåŠ¡å™¨ï¼Œå†…å®¹å®Œå…¨ç¼–ç åœ¨äºŒç»´ç ä¸­ã€‚
          </p>

          <div class="form-row">
            <label>çº é”™ç­‰çº§</label>
            <select
              id="offline-qr-level"
              style="
                flex: 1;
                padding: 8px 10px;
                border: 1px solid #ddd;
                border-radius: 8px;
              "
            >
              <option value="L">L (çº¦7%çº é”™)</option>
              <option value="M">M (çº¦15%çº é”™)</option>
              <option value="Q" selected>Q (çº¦25%çº é”™ï¼Œæ¨è)</option>
              <option value="H">H (çº¦30%çº é”™ï¼Œæœ€å¤§å®¹é”™)</option>
            </select>
          </div>

          <div class="form-row">
            <label>å›¾ç‰‡å¤„ç†</label>
            <div style="flex: 1">
              <input
                type="file"
                id="image-upload"
                accept="image/*"
                multiple
                style="display: none"
              />
              <button
                id="upload-images-btn"
                class="btn"
                style="margin-right: 8px"
              >
                ä¸Šä¼ å›¾ç‰‡ï¼ˆè½¬ä¸ºBase64ï¼‰
              </button>
              <small style="display: block; margin-top: 4px; color: #666">
                æç¤ºï¼šä¸Šä¼ figureç›®å½•ä¸‹çš„å›¾ç‰‡ï¼ˆup_1.jpg ~ up_7.jpg, down_1.jpg ~
                down_6.jpgï¼‰ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è½¬æ¢ä¸ºBase64å¹¶å†…è”åˆ°HTMLä¸­ã€‚<br />
                ä¹Ÿå¯ä»¥ä½¿ç”¨
                <a href="./image-converter.html" target="_blank"
                  >å›¾ç‰‡è½¬æ¢å·¥å…·</a
                >
                é¢„å…ˆå¤„ç†å›¾ç‰‡ã€‚
              </small>
            </div>
          </div>

          <div
            id="uploaded-images"
            style="
              margin: 12px 0;
              padding: 12px;
              background: #f5f5f5;
              border-radius: 8px;
              display: none;
            "
          >
            <strong>å·²ä¸Šä¼ å›¾ç‰‡ï¼š</strong>
            <div
              id="image-list"
              style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 8px"
            ></div>
          </div>

          <div
            style="
              margin: 16px 0;
              padding: 12px;
              background: #fff3cd;
              border-radius: 8px;
              border-left: 4px solid #ffc107;
            "
          >
            <strong>âš ï¸ é‡è¦æç¤ºï¼š</strong>
            <ul style="margin: 8px 0 0 20px; padding: 0">
              <li>
                <strong>æ‰«ç åç›´æ¥æ˜¾ç¤ºHTMLé¡µé¢ï¼Œä¸è·³è½¬åˆ°ä»»ä½•URLï¼</strong
                >äºŒç»´ç ä½¿ç”¨ data:text/html;base64, åè®®
              </li>
              <li>ç¦»çº¿äºŒç»´ç åŒ…å«å®Œæ•´HTMLå†…å®¹ï¼Œå»ºè®®é¡µé¢å¤§å°æ§åˆ¶åœ¨2MBä»¥å†…</li>
              <li>å›¾ç‰‡å»ºè®®å‹ç¼©åå†ä¸Šä¼ ï¼Œä»¥å‡å°äºŒç»´ç å¤æ‚åº¦</li>
              <li>
                éƒ¨åˆ†æ‰«ç å·¥å…·å¯èƒ½ä¸æ”¯æŒ data:
                åè®®ï¼Œå»ºè®®ä½¿ç”¨å¾®ä¿¡ã€æ”¯ä»˜å®æˆ–ç³»ç»Ÿç›¸æœºæ‰«ç æµ‹è¯•
              </li>
              <li>
                ç”Ÿæˆåå»ºè®®å…ˆç‚¹å‡»"é¢„è§ˆHTMLé¡µé¢"æŸ¥çœ‹æ•ˆæœï¼Œç¡®è®¤æ— è¯¯åå†ä¸‹è½½äºŒç»´ç 
              </li>
            </ul>
          </div>

          <div class="qr-box" style="margin-top: 16px">
            <div
              id="offline-qrcode"
              style="
                width: 280px;
                height: 280px;
                background: #fff;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 2px dashed #ddd;
              "
            ></div>
            <div>
              <p><strong>äºŒç»´ç ä¿¡æ¯ï¼š</strong></p>
              <p>HTMLå¤§å°ï¼š<span id="html-size">-</span></p>
              <p>Base64å¤§å°ï¼š<span id="base64-size">-</span></p>
              <p>äºŒç»´ç ç‰ˆæœ¬ï¼š<span id="qr-version">-</span></p>
              <div
                style="
                  margin-top: 12px;
                  display: flex;
                  gap: 8px;
                  flex-wrap: wrap;
                "
              >
                <button id="gen-offline-qr" class="btn primary">
                  ç”Ÿæˆç¦»çº¿äºŒç»´ç 
                </button>
                <button
                  id="preview-offline-html"
                  class="btn"
                  style="background: #28a745; color: white"
                >
                  é¢„è§ˆHTMLé¡µé¢
                </button>
                <button id="download-offline-qr" class="btn">
                  ä¸‹è½½ç¦»çº¿äºŒç»´ç PNG
                </button>
                <button id="download-offline-html" class="btn">
                  ä¸‹è½½ç¦»çº¿HTMLæ–‡ä»¶
                </button>
              </div>
              <small style="display: block; margin-top: 8px; color: #666">
                ğŸ’¡
                æç¤ºï¼šç”ŸæˆäºŒç»´ç åï¼Œç‚¹å‡»"é¢„è§ˆHTMLé¡µé¢"å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ç›´æ¥æŸ¥çœ‹æ•ˆæœï¼ˆæ¨¡æ‹Ÿæ‰«ç åçš„æ˜¾ç¤ºï¼‰ï¼Œç¡®è®¤æ— è¯¯åå†ä¸‹è½½äºŒç»´ç ã€‚
              </small>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- QRCode åº“ï¼ˆCDNï¼‰ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
      (function () {
        const ts = Date.now();
        const link = document.querySelector('link[rel="stylesheet"]');
        if (link) link.href = link.href.replace("{{ts}}", ts);
      })();
    </script>
    <script src="./admin.js?v=20250114-1"></script>
  </body>
</html>
